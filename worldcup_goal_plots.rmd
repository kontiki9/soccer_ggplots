---
title: "Untitled"
author: "RN7"
date: "June 20, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Recreate & Animate Your Favorite World Cup Goals!

After posting a couple of my World Cup viz on Twitter, I thought I'll collate some of them into a blog post!



Let's look at some of the packages we will use!

```{r}

```

You can also grab images from URLs and 


```{r}

```


The only problem with doing this is manually creating the data points. This is more a problem of access rather than availability as sports analytics firms, most notably Opta, generate a huge amount of data for every player in every match, however it is not easy for a regular dude like me to buy it. 

Some people have managed to create some nice heatmaps by scraping WhoScored.com and other sites (that create their viz from purchased data from Opta) but that was a bit of my expertise so I resorted to creating the coordinate positions by hand. Thankfully, due to the plotting system in `ggsoccer` and `ggplot2` it's very easy to figure out the positions on the soccer field plot.

In the next part, I will create some animations of these goal graphics. I've been slowly working my way through them so here is a preview:

- [show both]
- Osako's goal is easier because I simplified it to have only the ball be moving
- Gazinsky's goal is harder because there are lots of moving parts that absolutely need to be included.

Until next time, and keep an eye on your twitter feed to see some more World Cup viz as we go!

First Goal!

```{r first goal}
library(ggplot2)
library(dplyr)
library(ggsoccer)
library(ggimage)
library(extrafont)
# loadfonts()

#                              2   1  
pass_data <- data.frame(x = c( 84, 82),
                        y = c(  6, 32),
                        x2 = c(77, 84),
                        y2 = c(13, 8))

#                            corner kick + golovin cross
curve_data <- data.frame(x = c(100, 76),
                         y = c(0, 19),
                         x2 = c(94, 94),
                         y2 = c(35, 60))

# Saudi failed clearance 
clearance_data <- data.frame(x = c(94),
                             y = c(35),
                             x2 = c(82),
                             y2 = c(33.5))

# Gazinski header
goal_data <- data.frame(x = c(94),
                        y = c(60),
                        x2 = c(99.2),
                        y2 = c(47.5))

# soccer ball image
goal_img <- data.frame(x = 100,
                       y = 47) %>% 
  mutate(image = "https://d30y9cdsu7xlg0.cloudfront.net/png/43563-200.png")

# golovin movement
golovin_data <- data.frame(x = c(83),
                           y = c(24.25),
                           x2 = c(77),
                           y2 = c(21))

# zhirkov movement 
zhirkov_data <- data.frame(x = 98,
                           y = 2,
                           x2 = 88,
                           y2 = 6)

g <- ggplot(pass_data) +
  annotate_pitch() +
  geom_segment(aes(x = x, y = y, xend = x2, yend = y2),
               arrow = arrow(length = unit(0.25, "cm"),
                             type = "closed")) +
  geom_segment(data = clearance_data,
               aes(x = x, y = y, xend = x2, yend = y2
                   ), linetype = "dashed", size = 0.85) +
  geom_segment(data = goal_data,
               aes(x = x, y = y, xend = x2, yend = y2
                   ), linetype = "dashed", color = "red", size = 0.85) +
  geom_segment(data = golovin_data,
               aes(x = x, y = y, xend = x2, yend = y2
                   ), linetype = "dashed", color = "darkgreen", size = 1.2) +
  geom_segment(data = zhirkov_data,
               aes(x = x, y = y, xend = x2, yend = y2
                   ), linetype = "dashed", color = "darkgreen", size = 1.25) +
  geom_curve(data = curve_data, 
             aes(x = x, y = y, xend = x2, yend = y2), 
             curvature = 0.25, 
             arrow = arrow(length = unit(0.25, "cm"),
                             type = "closed")) +
  geom_image(data = goal_img,
             aes(x = x, y = y,
                 image = image), size = 0.035) +
  theme_pitch() + 
  theme(text = element_text(family = "Trebuchet MS")) +
  coord_flip(xlim = c(49, 101),
             ylim = c(-1, 101)) +
  ggtitle(label = "Russia (5) vs. (0) Saudi Arabia", 
          subtitle = "First goal, Yuri Gazinsky (12th Minute)") +
  labs(caption = "By Ryo Nakagawara (@R_by_Ryo)") +
  geom_label(aes(x = 94, y = 60, label = "Gazinsky"), hjust = -0.1) +
  geom_label(aes(x = 83, y = 23, label = "Golovin"), hjust = -0.05) +
  geom_label(aes(x = 75, y = 11, label = "Golovin"), hjust = -0.1) +
  geom_label(aes(x = 98, y = 0, label = "Zhirkov"), vjust = -0.3) +
  geom_label(aes(x = 84, y = 6, label = "Zhirkov"), vjust = -0.3) +
  annotate("text", x = 69, y = 65, family = "Trebuchet MS",
           label = "After a poor corner kick clearance\n from Saudi Arabia, Golovin picks up the loose ball, \n exchanges a give-and-go pass with Zhirkov\n before finding Gazinsky with a beautiful cross!")

ggsave(g, filename = "gazinsky_goal.png")
```



Cristiano Hat Trick

NOTE: you need to play around with the margins in `theme()` and the `width` or `height` arguments in `ggsave()` to remove the extraneous white space that appears.

```{r cristiano hat trick}
library(ggplot2)
library(ggsoccer)
library(extrafont)
library(emoGG)
library(ggimage)
# loadfonts()
# Official WC 2018 Font: "Dusha"
# http://fifa2018wiki.com/fifa-2018-font-typeface-download-dusha-font-ttf/509/

emoji_search("soccer")  # "26bd"

goals_data <- data.frame(x = c(88, 80, 71),
                         y = c(50, 48, 54))

curve_data <- data.frame(x = c(88, 71), y = c(50, 54),
                         xend = c(100, 100), yend = c(54, 54))

annotation_data <- data.frame(
  hjust = c(0.5, 0.5, 0.5, 0, 0, 0),
           size = c(6.5, 4.5, 3, 3.5, 3.5, 3.5),
           label = c("Portugal             (3) vs. Spain             (3)",
                     "Cristiano's Hattrick (4', 44', 88')",
                     "by Ryo Nakagawara (@R_by_Ryo)",
                     "1. Fouled by Nacho in the box,\nCristiano confidently strokes the ball\ninto the right corner from the spot.",
                     "2. Guedes lays it off to Cristiano whose\nstrong shot is uncharacteristically\nfumbled by De Gea into the net.",
                     "In the final minutes of the game,\nCristiano wins a freekick against Pique\nand curls it beautifully over the wall."),
           x = c(110, 105, 53, 76, 66, 66), 
           y = c(30, 20, 85, 5, 5, 55)
)

flag_data <- data.frame(
  image = c("PT, ES"),
  x = c(110, 110),
  y = c(19.1, 51.1),
  size = 0.08
)

# PLOT

cr <- ggplot(goals_data) +
  annotate_pitch() +
  theme_pitch() +
  theme(text = element_text(family = "Dusha V5")) +
  coord_flip(xlim = c(55, 112),
             ylim = c(-1, 101)) +
  geom_segment(x = 80, y = 48, 
               xend = 97, yend = 48) +  # 2nd 
  geom_segment(x = 97, y = 48, 
               xend = 100, yend = 45.5,
               arrow = arrow(length = unit(0.25, "cm"),
                             type = "closed")) +        # degea fumble
  geom_curve(data = curve_data,
             aes(x = x, y = y, 
                 xend = xend, yend = yend),     # FREEKICK
             curvature = 0.3, 
             arrow = arrow(length = unit(0.25, "cm"), type = "closed")) +
  geom_text(data = annotation_data,
            family = "Dusha V5", 
            aes(x = x, y = y,
                hjust = hjust, size = size, label = label)) +
  ggimage::geom_flag(data = flag_data,
                     aes(x = x, y = y,
                       image = image, size = size)       # Portugal Flag
                     ) +
  ggimage::geom_emoji(aes(x = 105, 
                          y = c(45, 50, 55)),
             image = "26bd", size = 0.035) +
  geom_point(aes(x = x, y = y), 
             shape = 21, size = 7, color = "black", fill = "white") +
  geom_text(aes(x = x, y = y, label = c(1, 2, 3)), family = "Dusha V5")

ggsave(cr, filename = "cr_hattrick.png", height = 5)
```


```{r check flags}

goals_data <- data.frame(x = c(88, 80, 71),
                         y = c(50, 48, 54))

flag_data <- data.frame(
  image = c("PT, ES"),
  x = c(110, 110),
  y = c(19.1, 51.1),
  size = 0.08
)


ggplot(goals_data) +
  annotate_pitch() +
  theme_pitch() +
  theme(text = element_text(family = "Dusha V5")) +
  coord_flip(xlim = c(55, 112),
             ylim = c(-1, 101)) +
  ggimage::geom_flag(data = flag_data,
                     aes(x = x, y = y,
                       image = image, size = size)) 
```




Osako's Winner against Colombia!


```{r osako winner}
library(ggplot2)
library(dplyr)
library(ggsoccer)
library(extrafont)
library(emoGG)
library(ggimage)


cornerkick_data <- data.frame(x = 99, y = 0.3,
                              x2 = 94, y2 = 47)

osako_gol <- data.frame(x = 94, y = 49,
                        x2 = 100, y2 = 55.5)

player_label <- data.frame(x = c(92, 99), 
                           y = c(49, 2))

wc_logo <- data.frame(x = 107,
                       y = 85) %>% 
  mutate(image = "https://upload.wikimedia.org/wikipedia/en/thumb/6/67/2018_FIFA_World_Cup.svg/1200px-2018_FIFA_World_Cup.svg.png")


g <- ggplot(osako_gol) +
  annotate_pitch() +
  theme_pitch() +
  theme(text = element_text(family = "Dusha V5")) +
  coord_flip(xlim = c(55, 112),
             ylim = c(-1, 101)) +
  geom_curve(data = cornerkick_data,
             aes(x = x, y = y, xend = x2, yend = y2),
             curvature = -0.15, 
             arrow = arrow(length = unit(0.25, "cm"),
                             type = "closed")) +
  geom_segment(aes(x = x, y = y, xend = x2, yend = y2),
               arrow = arrow(length = unit(0.25, "cm"),
                             type = "closed")) +
  geom_label(data = player_label, 
             aes(x = x, y = y),
             label = c("Osako", "Honda"), family = "Dusha V5") +
  geom_point(aes(x = 98, y = 50), size = 3, color = "green") +
  geom_text(aes(x = 99.7, y = 50), size = 5, label = "???", family = "Dusha V5") +
  annotate(geom = "text", family = "Dusha V5", 
           hjust = c(0.5, 0.5, 0.5, 0.5, 0.5),
           size = c(6.5, 4.5, 4, 3.5, 3),
           label = c("Japan             (2) vs. Colombia             (1)",
                     "Kagawa (PEN 6'), Quintero (39'), Osako (73')",
                     "Japan press their man advantage, substitute Honda\ndelivers a delicious corner kick for Osako to (somehow) tower over\nColombia's defense and flick a header into the far corner!",
                     "Bonus: Ospina looking confused and\ndoing a lil' two-step-or-god-knows-what.",
                     "by Ryo Nakagawara (@R_by_Ryo)"),
           x = c(110, 105, 70, 92, 53), 
           y = c(30, 30, 45, 81, 85)) +
  ggimage::geom_flag(aes(image = "JP"),       # Japan Flag
            x = 110, y = 13, size = 0.08) +
  ggimage::geom_flag(aes(image = "CO"),       # Colombia Flag
            x = 110, y = 53, size = 0.08) +
  ggimage::geom_emoji(aes(x = 95, 
                          y = 50),
             image = "26bd", size = 0.035) +
  geom_image(data = wc_logo,
             aes(x = x, y = y,
                 image = image), size = 0.17) +
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"))
  
ggsave(g, filename = "osako_winner.png", height = 5)
```

## Animated version:

```{r osako anim}
library(ggplot2)
library(dplyr)
library(ggsoccer)
library(extrafont)
library(emoGG)
library(ggimage)
library(gganimate)


ball_data <- data.frame(x = c(99, 94, 100),
                        y = c(0.3, 47, 55.5),
                        time = c(1, 2, 3))

player_label <- data.frame(x = c(92, 99), 
                           y = c(49, 2))

wc_logo <- data.frame(x = 107,
                       y = 85) %>% 
  mutate(image = "https://upload.wikimedia.org/wikipedia/en/thumb/6/67/2018_FIFA_World_Cup.svg/1200px-2018_FIFA_World_Cup.svg.png")


g <- ggplot(ball_data) +
  annotate_pitch() +
  theme_pitch() +
  theme(text = element_text(family = "Dusha V5")) +
  coord_flip(xlim = c(55, 112),
             ylim = c(-1, 101)) +
  geom_label(data = player_label, 
             aes(x = x, y = y),
             label = c("Osako", "Honda"), family = "Dusha V5") +
  geom_point(aes(x = 98, y = 50), size = 3, color = "green") +
  geom_text(aes(x = 99.7, y = 50), size = 5, label = "???", family = "Dusha V5") +
  annotate(geom = "text", family = "Dusha V5", 
           hjust = c(0.5, 0.5, 0.5, 0.5, 0.5),
           size = c(6.5, 4.5, 4, 3.5, 3),
           label = c("Japan             (2) vs. Colombia             (1)",
                     "Kagawa (PEN 6'), Quintero (39'), Osako (73')",
                     "Japan press their man advantage, substitute Honda\ndelivers a delicious corner kick for Osako to (somehow) tower over\nColombia's defense and flick a header into the far corner!",
                     "Bonus: Ospina looking confused and\ndoing a lil' two-step-or-god-knows-what.",
                     "by Ryo Nakagawara (@R_by_Ryo)"),
           x = c(110, 105, 70, 92, 53), 
           y = c(30, 30, 45, 81, 85)) +
  ggimage::geom_flag(aes(image = "JP"),       # Japan Flag
            x = 110, y = 13, size = 0.08) +
  ggimage::geom_flag(aes(image = "CO"),       # Colombia Flag
            x = 110, y = 53, size = 0.08) +
  ggimage::geom_emoji(aes(x = x, 
                          y = y,
                          frame = time),
             image = "26bd", size = 0.035) +
  geom_image(data = wc_logo,
             aes(x = x, y = y,
                 image = image), size = 0.17) +
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"))

g

gganimate(g, "osako_ani.gif") 

# TWEEN

library(purrr)
library(tweenr)

ball_list <- map(seq(nrow(ball_data)),
                      ~ ball_data[c(seq(.x), rep(.x, nrow(ball_data) - .x)), ])
  
osako_tween <- ball_list %>% 
  tween_states(tweenlength = 2, statelength = 1.25, ease = "linear", nframes = 200)

g2 <- ggplot(osako_tween) +
  annotate_pitch() +
  theme_pitch() +
  theme(text = element_text(family = "Dusha V5")) +
  coord_flip(xlim = c(55, 112),
             ylim = c(-1, 101)) +
  geom_label(data = player_label, 
             aes(x = x, y = y),
             label = c("Osako", "Honda"), family = "Dusha V5") +
  geom_point(aes(x = 98, y = 50), size = 3, color = "green") +
  annotate(geom = "text", family = "Dusha V5", 
           hjust = c(0.5, 0.5, 0.5, 0.5, 0.5),
           size = c(6.5, 4.5, 4, 3.5, 3),
           label = c("Japan             (2) vs. Colombia             (1)",
                     "Kagawa (PEN 6'), Quintero (39'), Osako (73')",
                     "Japan press their man advantage, substitute Honda\ndelivers a delicious corner kick for Osako to (somehow) tower over\nColombia's defense and flick a header into the far corner!",
                     "Bonus: Ospina looking confused and\ndoing a lil' two-step-or-god-knows-what.",
                     "by Ryo Nakagawara (@R_by_Ryo)"),
           x = c(110, 105, 70, 92, 53), 
           y = c(30, 30, 45, 81, 85)) +
  ggimage::geom_emoji(aes(x = x, 
                          y = y,
                          frame = .frame),
             image = "26bd", size = 0.035) +
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"))

g2

gganimate(g2, 
          ani.width = 800, ani.height = 500, 
          interval = 0.25,
          "osako_tween.gif") 

# multiple balls appearing after every pause...??????

```


## VAR Decisions

```{r var }

```




## Shots on Goal: On + Off Target

```{r shots on goal}

```


## Formation and line-ups

make function for set formations 
- all you need to do is pass player names and formation string ("3-5-2", "4-4-2", etc.)
- later version: player icon with uniform (like in Wikipedia)

```{r formations}

```



### Animate!

```{r}
label_data <- data.frame(
  x = c(94, 78, 73, 98, 82),
  y = c(60, 26, 9, 0, 3),
  time = c(1, 2, 3, 1, 3),
  label = c("Gazinsky", "Golovin", "Golovin", "Zhirkov", "Zhirkov"),
  hjust = c(-0.1, -0.05, -0.1, 0, 0),
  vjust = c(0, 0, 0, -0.3, -0.3)
)
```



```{r ani data}
library(ggplot2)
library(dplyr)
library(ggsoccer)
library(ggimage)
library(extrafont)
library(gganimate)
library(tweenr)
# loadfonts()

# data
pass_data <- data.frame(
  x = c(100, 94, 82, 82.5,  84, 77, 76, 94, 99.2),       # pass balls
  y = c(0,   35, 31, 25,     6, 13, 19, 60, 47.5),
  label = "ball movement",
  time = c(1, 2, 3, 4, 5, 6, 7, 8, 9))

golovin_movement <- data.frame(
  x = c(98, 80, 80, 80, 75, 74, 73, 73, 73),
  y = c( 0, 30, 25, 20,  10, 9, 15, 20, 20),
  label = "Golovin",
  time = c(1, 2, 3,  4,  5,  6,  7,  8,  9)
)

zhirkov_movement <- data.frame(
  x = c(97, 90, 82, 82, 82, 82, 82, 82, 82),
  y = c( 0,  2,  3,  3,  3,  3,  3,  3,  3),
  label = "Zhirkov",
  time = c(1, 2, 3, 4, 5, 6, 7, 8, 9)
)

segment_data <- data.frame(
  x = c(83, 98),
  y = c(24.25, 2),
  xend = c(77, 88),
  yend = c(21, 6),
  linetype = c("dashed", "dashed"),
  color = c("darkgreen", "darkgreen"),
  size = c(1.2, 1.25)
)

saudi_data <- data.frame(
  x = c(95),
  y = c(35)
)

data <- tribble(
  ~x,  ~y,  ~label, ~time,
  100,  0,  "ball",     1,
   98,  0, "Golovin",   1,
   98,  0, "Zhirkov",   1,
   94, 35, "ball",      2,
   80, 30, "Golovin",   2,
   90,  2, "Zhirkov",   2,
   82, 31, "ball",      3,
   80, 25, "Golovin",   3,
   82,  3, "Zhirkov",   3, 
   82.5, 25, "ball",    4,
   80, 20, "Golovin",   4, 
   82,  3, "Zhirkov",   4,
   84,  6, "ball",      5, 
   75, 10, "Golovin",   5,
   82,  3, "Zhirkov",   5, 
   77, 13, "ball",      6,
   74,  9, "Golovin",   6,
   82,  3, "Zhirkov",   6,
   76, 19, "ball",      7,
   73, 15, "Golovin",   7,
   82,  3, "Zhirkov",   7,
   94, 60, "ball",      8,
   73, 20, "Golovin",   8,
   82,  3, "Zhirkov",   8,
   99.2, 47.5, "ball",  9,
   73, 20, "Golovin",   9,
   82,  3, "Zhirkov",   9
  
)
# arrange by time!
# instead of string label, give numerical ID value? but the IDs themselves will get "interpolated".... wtf

data2 <- data %>% select(-label)

```


```{r ani plot}
ani <- ggplot(pass_data) +
  annotate_pitch() +
  theme_pitch() +
  coord_flip(xlim = c(49, 101),
             ylim = c(-1, 101)) +
  geom_segment(data = segment_data, 
               aes(x = x, y = y, 
                   xend = xend, yend = yend),
               size = segment_data$size,
               color = segment_data$color,
               linetype = c("dashed", "dashed")) +
  geom_label(
    data = golovin_movement,
    aes(x = x, y = y,
        frame = time,
        label = label)) +
  geom_label(
    data = zhirkov_movement,
    aes(x = x, y = y,
        frame = time,
        label = label)) +
  geom_point(
    data = saudi_data,
    aes(x = x, y = y),
    color = "darkgreen",
    size = 5) +
  ggimage::geom_emoji(
    aes(x = x, y = y, 
        frame = time), 
    image = "26bd", 
    size = 0.035) +
  theme(text = element_text(family = "Dusha V5")) +
  ggtitle(label = "Russia (5) vs. (0) Saudi Arabia", 
          subtitle = "First goal, Yuri Gazinsky (12th Minute)") +
  labs(caption = "By Ryo Nakagawara (@R_by_Ryo)") +
  annotate("text", x = 69, y = 65, family = "Dusha V5",
           label = "After a poor corner kick clearance\n from Saudi Arabia, Golovin picks up the loose ball, \n exchanges a give-and-go pass with Zhirkov\n before finding Gazinsky with a beautiful cross!")

gganimate(ani, "ani.gif")  # use frame to check positionings...

```

A bit choppy, but the ball is in motion!

Let's fix this choppiness by interpolating our x,y coordinates to create a smoother animation between the passing points. 




Now use tweenr!

```{r tween data}
library(purrr)

# all tween
data_list <- map(seq(nrow(data)),
                      ~ data[c(seq(.x), rep(.x, nrow(data) - .x)), ])
  
data_tween <- data_list %>% 
  tween_states(tweenlength = 2, statelength = 1.25, ease = "linear", nframes = 200)    # Error in col2rgb(d) : invalid color name 'ball'


# sans labels col
data_list <- map(seq(nrow(data2)),
                      ~ data2[c(seq(.x), rep(.x, nrow(data2) - .x)), ])
  
data_tween <- data_list %>% 
  tween_states(tweenlength = 2, statelength = 1.25, ease = "linear", nframes = 200)


# plot

gazinsky_goal <- data_tween %>% 
  ggplot() +
  annotate_pitch() +
  theme_pitch() +
  coord_flip(xlim = c(49, 101),
             ylim = c(-1, 101)) +
  geom_segment(data = segment_data, 
               aes(x = x, y = y, 
                   xend = xend, yend = yend),
               size = segment_data$size,
               color = segment_data$color,
               linetype = c("dashed", "dashed")) +
  geom_point(
    data = saudi_data,
    aes(x = x, y = y),
    color = "darkgreen",
    size = 5) +
  ggimage::geom_emoji(
    aes(x = x, y = y, frame = .frame),    # change frame to .frame or it'll still move by time only -_-
    image = "26bd", size = 0.035) +
  theme(text = element_text(family = "Dusha V5")) +
  ggtitle(label = "Russia (5) vs. (0) Saudi Arabia", 
          subtitle = "First goal, Yuri Gazinsky (12th Minute)") +
  labs(caption = "By Ryo Nakagawara (@R_by_Ryo)") +
  annotate("text", x = 69, y = 65, family = "Dusha V5",
           label = "After a poor corner kick clearance\n from Saudi Arabia, Golovin picks up the loose ball, \n exchanges a give-and-go pass with Zhirkov\n before finding Gazinsky with a beautiful cross!")
  
  

# you can seee the ball "travelling along"

gganimate(gazinsky_goal, 
          ani.width = 800, ani.height = 500, 
          interval = 0.25, 
          "gazinsky_goal.gif")

```


- shift coordinates to make ball look like being dribbled by the player labels
- track player runs? necessary? maybe just as extra step.
- add Saudi player clearance as Green Dot
- try with tween_elements() again........



```{r}
golovin_movement_list <- map(seq(nrow(golovin_movement)),
                      ~golovin_movement[c(seq(.x), rep(.x, nrow(golovin_movement) - .x)), ])
  
golovin_tween <- golovin_movement_list %>% 
  tween_states(tweenlength = 2, statelength = 1.5, ease = "linear", nframes = 200)




gazinsky_goal <- ggplot(pass_data) +
  annotate_pitch() +
  theme_pitch() +
  coord_flip(xlim = c(49, 101),
             ylim = c(-1, 101)) +
  geom_segment(data = segment_data, 
               aes(x = x, y = y, 
                   xend = xend, yend = yend),
               size = segment_data$size,
               color = segment_data$color,
               linetype = c("dashed", "dashed")) +
  geom_label(
    aes(x = x2, y = y2,
        frame = time,
        label = label)) +
  ggimage::geom_emoji(
    aes(x = x, y = y, frame = time), 
    image = "26bd", size = 0.035)

gganimate(gazinsky_goal, 
          ani.width = 800, ani.height = 500, 
          title_frame = FALSE, interval = 0.25, 
          "gazinsky_goal.gif")
```



PR for formations function?

Try more advanced soccer play-by-play animations?

Recreate famous World Cup goals of the past? (Maradona vs. England?)



```{r}
pass_data <- data.frame(x = c(100, 94, 82,  84, 77, 76, 94, 99.2),
                        y = c(0,   35, 33.5, 6, 13, 19, 60, 47.5),
                        time = c(1, 2, 3, 4, 5, 6, 7, 8))

data <- data.frame(x = 1, y = 1)

ggplot(data) +
  annotate_pitch() +
  theme_pitch() +
  coord_flip(xlim = c(49, 101),
             ylim = c(-1, 101))
```


## Japan's Offside Trap!

```{r}

```




+ the meme generator with R

```{r meme}
library(memery)
img <- ("https://imgflip.com/s/meme/Roll-Safe-Think-About-It.jpg")

meme_labs <- c("you can't lose the aerial battle", "if you set an offside trap")

meme(img, meme_labs, "offside_meme.png")

```






## Group Standings during Final Match Day!

```{r fig.width=10, fig.height=6}
library(dplyr)
library(ggplot2)
library(ggimage)
library(countrycode)
library(tidyr)
library(forcats)
library(extrafont)
# loadfonts()  run once per new session!

group_b <- data.frame(

  time = c(1, 2, 3, 4, 5, 6, 7, 8),
  spain = c(1, 2, 1, 2, 2, 2, 1, 1),
  portugal = c(2, 1, 2, 1, 1, 1, 2, 2),
  iran = c(3, 3, 3, 3, 4, 3, 3, 3),
  morocco = c(4, 4, 4, 4, 3, 4, 4, 4)
  
)

group_b <- group_b %>% 
  gather(team, position, -time) %>% 
  mutate(team = as.factor(team),
         team = fct_relevel(team, 
                            "spain", "portugal", "iran", "morocco"),
         flag = team %>% 
           countrycode(., origin = "country.name", destination = "iso2c"))

x_labs <- c("0'", "14'", "19'", "45'", "81'", "90 + 1'", "90 + 3'", "Full Time")
y_labs <- c("1st", "2nd", "3rd", "4th")

score_labs <- data.frame(
  x = c(2, 3, 4, 5, 6, 7, 8, 8, 8, 8),
  y = c(2, 1, 1, 3, 4, 2, 1, 2, 3, 4),
  score = c("0-1", "1-1", "1-0", "2-1", "2-2", "1-1",
            "2-2", "1-1", "1-1", "2-2")
)

country_labs <- data.frame(
  x = c(1, 1, 1, 1),
  y = c(1, 2, 3, 4),
  country = c("Spain", "Portugal", "Iran", "Morocco")
)

ggplot(
  group_b,
  aes(time, position)) +
  geom_line(
    aes(group = team), linetype = "dashed") +
  geom_flag(
    aes(image = flag), 
    size = 0.1) +
  geom_text(
    data = country_labs,
    aes(x = x, y = y, 
        label = country,
        family = "Dusha V5"),
    nudge_y = 0.25) +
  geom_text(
    data = score_labs,
    aes(x = x, y = y, 
        label = score,
        family = "Dusha V5"),
    nudge_y = 0.25) +
  scale_y_reverse(
    expand = c(0, 0), 
    limits = c(4.5, 0.6),
    breaks = 1:4,
    labels = y_labs) +
  scale_x_continuous(
    position = "top", 
    breaks = 1:8,
    labels = x_labs,
    limits = c(0.5, 8.5)) +
  labs(
    x = "", y = "",
    title = "Group B Table Throughout The Last Matchday",
    subtitle = "Iran vs. Portugal & Spain vs. Morocco") +
  theme_minimal() +
  theme(
    text = element_text(family = "Dusha V5", size = 18),
    legend.position = "none",
    panel.grid = element_blank())


```

how to emphasize IRAN vs. PORTUGAL and SPAIN sv. MOROCCO   ???










